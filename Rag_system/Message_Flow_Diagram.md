# 🔄 رسم توضيحي لمسار الرسالة

## 📊 مخطط تدفق الرسالة

```
┌─────────────────┐
│    المستخدم     │
│                 │
│ "كم سعر شيبس    │
│  ليز؟"          │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│   API Gateway   │
│                 │
│ POST /ask       │
│ {               │
│   question:     │
│   user_id:      │
│   user_name:    │
│ }               │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│  التحقق من      │
│  صحة البيانات   │
│                 │
│ ✅ السؤال موجود │
│ ✅ user_id صحيح │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│  التوجيه الذكي  │
│                 │
│ 1️⃣ مطابقة       │
│    الكلمات      │
│    المفتاحية    │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│   النتيجة؟      │
│                 │
│ ❌ لم يجد        │
│    مطابقة       │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│   توجيه LLM     │
│                 │
│ 2️⃣ تحليل        │
│    ذكي للسؤال   │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│   النتيجة؟      │
│                 │
│ ✅ فهم السؤال    │
│    - نوع: سعر   │
│    - منتج: شيبس │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│  قاعدة البيانات │
│                 │
│ 3️⃣ البحث في     │
│    المنتجات     │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│   SQL Query     │
│                 │
│ SELECT * FROM   │
│ products WHERE  │
│ name_ar LIKE    │
│ '%شيبس ليز%'    │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│   النتيجة؟      │
│                 │
│ ✅ وجد المنتج    │
│    - السعر: 2.00│
│    - الفئة: مقرمشات│
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│  تنسيق الإجابة  │
│                 │
│ "سعر شيبس ليز   │
│  2.00 ريال"     │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│  حفظ في الذاكرة │
│                 │
│ 💾 حفظ السؤال   │
│    والإجابة     │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│  إرسال الإجابة  │
│                 │
│ {               │
│   answer: "سعر  │
│   شيبس ليز 2.00 │
│   ريال",        │
│   confidence:   │
│   0.95,         │
│   method: "llm_ │
│   router"       │
│ }               │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│    المستخدم     │
│                 │
│ "سعر شيبس ليز   │
│  2.00 ريال"     │
└─────────────────┘
```

## 🔄 مسار بديل: مطابقة الكلمات المفتاحية

```
┌─────────────────┐
│    المستخدم     │
│                 │
│ "اهلا"          │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│  التوجيه الذكي  │
│                 │
│ 1️⃣ مطابقة       │
│    الكلمات      │
│    المفتاحية    │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│   النتيجة؟      │
│                 │
│ ✅ وجد مطابقة    │
│    - "اهلا"     │
│    - رد مبرمج   │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│  إرسال الإجابة  │
│                 │
│ "أهلاً وسهلاً!" │
│ (فوري)          │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐
│    المستخدم     │
│                 │
│ "أهلاً وسهلاً!" │
└─────────────────┘
```

## ⚡ مقارنة السرعة

| الطريقة | الوقت | الدقة | الاستخدام |
|---------|-------|-------|-----------|
| **مطابقة الكلمات** | < 100ms | 95% | 60% من الأسئلة |
| **توجيه LLM** | < 2s | 90% | 30% من الأسئلة |
| **البحث الدلالي** | < 3s | 85% | 5% من الأسئلة |
| **قاعدة البيانات** | < 500ms | 95% | 5% من الأسئلة |

## 🎯 نقاط التحسين

### **1. التخزين المؤقت**
```
سؤال متكرر → Cache → إجابة فورية
```

### **2. المعالجة المتوازية**
```
الطرق الثلاث ← تشغيل متوازي ← أسرع نتيجة
```

### **3. تحسين قاعدة البيانات**
```
فهارس → بحث أسرع → استجابة محسنة
```

## 📈 إحصائيات الأداء

```
┌─────────────────────────────────────┐
│           متوسط الاستجابة           │
│                                     │
│  مطابقة الكلمات: ████████░░ 80%     │
│  توجيه LLM:      ██████░░░░ 60%     │
│  البحث الدلالي:  ████░░░░░░ 40%     │
│  قاعدة البيانات: ████████░░ 80%     │
└─────────────────────────────────────┘
```

هذا المسار يضمن **أسرع استجابة ممكنة** مع **أعلى دقة**! 🚀
