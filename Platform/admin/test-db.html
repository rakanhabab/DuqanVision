<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>اختبار قاعدة البيانات</title>
    <style>
        body { font-family: 'Tajawal', sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>اختبار قاعدة البيانات</h1>
    <div id="results"></div>

    <script type="module">
        import { db } from '../js/database.js';

        const resultsDiv = document.getElementById('results');

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            resultsDiv.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        async function testDatabase() {
            try {
                addResult('بدء اختبار قاعدة البيانات...', 'info');

                // Test 1: Check Supabase connection
                addResult('اختبار الاتصال بـ Supabase...', 'info');
                const { data: testData, error: testError } = await db.supabase
                    .from('users')
                    .select('count')
                    .limit(1);
                
                if (testError) {
                    addResult(`خطأ في الاتصال: ${testError.message}`, 'error');
                    return;
                }
                addResult('✅ الاتصال بـ Supabase يعمل', 'success');

                // Test 2: Get branches
                addResult('اختبار جلب الفروع...', 'info');
                const branches = await db.getBranches();
                addResult(`✅ تم جلب ${branches.length} فرع`, 'success');
                console.log('Branches:', branches);

                // Test 3: Get products
                addResult('اختبار جلب المنتجات...', 'info');
                const products = await db.getProducts();
                addResult(`✅ تم جلب ${products.length} منتج`, 'success');
                console.log('Products:', products);

                // Test 4: Get invoices
                addResult('اختبار جلب الفواتير...', 'info');
                const invoices = await db.getAllInvoices();
                addResult(`✅ تم جلب ${invoices.length} فاتورة`, 'success');
                console.log('Invoices:', invoices);

                // Test 5: Get inventory
                addResult('اختبار جلب المخزون...', 'info');
                const inventory = await db.getInventoryQuantities();
                addResult(`✅ تم جلب ${inventory.length} سجل مخزون`, 'success');
                console.log('Inventory:', inventory);

                addResult('🎉 جميع الاختبارات نجحت!', 'success');

            } catch (error) {
                addResult(`❌ خطأ عام: ${error.message}`, 'error');
                console.error('Test error:', error);
            }
        }

        // Run test when page loads
        testDatabase();
    </script>
</body>
</html>
