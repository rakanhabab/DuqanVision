<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>لوحة تحكم دكان فيجين | Dukkan Vision Admin</title>
    <meta name="description" content="لوحة تحكم إدارة متجر دكان فيجين" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&family=Cairo:wght@400;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="./admin.css">
    <link rel="stylesheet" href="./dashboard.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
        // Verify Plotly is loaded
        window.addEventListener('load', function() {
            if (typeof Plotly === 'undefined') {
                console.error('Plotly failed to load from CDN');
            } else {
                console.log('Plotly loaded successfully from CDN');
            }
        });
    </script>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="brand">
                    <img src="../../Front-End-new/img/Logo.png" alt="دكان فيجين" style="width: 120px; height: 120px; object-fit: contain;">
                </div>
            </div>
            <nav class="sidebar-nav">
                <ul class="nav-menu">
                    <li class="nav-item active">
                        <a href="./dashboard.html" class="nav-link">
                            الواجهة الرئيسية
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="./operations.html" class="nav-link">
                            إدارة العمليات
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="./operations2.html" class="nav-link">
                            إدارة العمليات - model
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="./inventory.html" class="nav-link">
                            إدارة المخزون
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="./branches.html" class="nav-link">
                            إدارة الفروع
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="./tickets.html" class="nav-link">
                            إدارة التذاكر
                        </a>
                    </li>
                </ul>
            </nav>
            <button class="logout-btn">تسجيل الخروج</button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h1>الواجهة الرئيسية</h1>
                <h2>نظرة عامة على الأداء</h2>
            </header>

            <!-- Dashboard Filters -->
            <div class="dashboard-filters">
                <div class="filter-group">
                    <label for="timeFilter">الفترة الزمنية:</label>
                    <select id="timeFilter" onchange="dashboardService.updateDashboard()">
                        <option value="today">اليوم</option>
                        <option value="week">هذا الأسبوع</option>
                        <option value="month" selected>هذا الشهر</option>
                        <option value="quarter">هذا الربع</option>
                        <option value="year">هذا العام</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="branchFilter">الفرع:</label>
                    <select id="branchFilter" onchange="dashboardService.updateDashboard()">
                        <option value="all">جميع الفروع</option>
                        <!-- Branch options will be loaded dynamically -->
                    </select>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card stat-sales">
                    <div class="stat-color-indicator"></div>
                    <div class="stat-content">
                        <h3>إجمالي المبيعات (صافي)</h3>
                        <div class="stat-value" id="netSalesValue">-- ر.س</div>
                        <div class="stat-change" id="netSalesChange"></div>
                    </div>
                </div>
                
                <div class="stat-card stat-orders">
                    <div class="stat-color-indicator"></div>
                    <div class="stat-content">
                        <h3>عدد الفواتير</h3>
                        <div class="stat-value" id="ordersValue">--</div>
                        <div class="stat-change" id="ordersChange"></div>
                    </div>
                </div>
                
                <div class="stat-card stat-aov">
                    <div class="stat-color-indicator"></div>
                    <div class="stat-content">
                        <h3>متوسط سلة الشراء (AOV)</h3>
                        <div class="stat-value" id="aovValue">-- ر.س</div>
                        <div class="stat-change" id="aovChange"></div>
                    </div>
                </div>
                
                <div class="stat-card stat-paid">
                    <div class="stat-color-indicator"></div>
                    <div class="stat-content">
                        <h3>نسبة المدفوعات (Paid%)</h3>
                        <div class="stat-value" id="paidRateValue">--%</div>
                        <div class="stat-change" id="paidRateChange"></div>
                    </div>
                </div>
                
                <div class="stat-card stat-refunds">
                    <div class="stat-color-indicator"></div>
                    <div class="stat-content">
                        <h3>قيمة المرتجعات</h3>
                        <div class="stat-value" id="refundsValue">-- ر.س</div>
                        <div class="stat-change" id="refundsChange"></div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-grid">
                <!-- Sales by Branch Chart -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>مبيعات الفروع</h3>
                    </div>
                    <div class="chart-container">
                        <div id="branchSalesChart" class="chart"></div>
                    </div>
                </div>

                <!-- Revenue Line Chart -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>الإيرادات الشهرية</h3>
                    </div>
                    <div class="chart-container">
                        <div id="revenueChart" class="chart"></div>
                    </div>
                </div>

                <!-- Products by Category Donut Chart -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>المنتجات المباعة</h3>
                    </div>
                    <div class="chart-container">
                        <div id="categoryChart" class="chart"></div>
                    </div>
                </div>

                <!-- Low Stock Products Chart -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>توافر المنتجات</h3>
                    </div>
                    <div class="chart-container">
                        <div id="lowStockChart" class="chart"></div>
                    </div>
                </div>
            </div>

            <!-- Low Stock Table -->
            <div class="table-card">
                <div class="table-header">
                    <h3>مخزون منخفض</h3>
                </div>
                <div class="table-container">
                    <table class="low-stock-table">
                        <thead>
                            <tr>
                                <th>الفرع</th>
                                <th>المنتج</th>
                                <th>الكمية المتوفرة</th>
                                <th>الحالة</th>
                            </tr>
                        </thead>
                        <tbody id="lowStockTableBody">
                            <!-- Filled dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script type="module" src="./dashboard.js"></script>
    <script type="module" src="./admin.js"></script>
</body>
</html>
