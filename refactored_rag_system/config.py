from typing import Dict, List, Tuple, Callable, Any
from dataclasses import dataclass
import os
import re
from dotenv import load_dotenv

# Load environment variables from config.env (one level up)
load_dotenv("../config.env")

@dataclass
class RAGConfig:
    openai_api_key: str
    supabase_url: str
    supabase_key: str
    model_name: str = os.getenv("MODEL_NAME", "gpt-3.5-turbo")
    temperature: float = float(os.getenv("MODEL_TEMPERATURE", "0.7"))
    max_tokens: int = int(os.getenv("MODEL_MAX_TOKENS", "1000"))
    chunk_size: int = 1000
    chunk_overlap: int = 200
    table_name: str = os.getenv("VECTOR_TABLE", "documents")
    query_name: str = os.getenv("VECTOR_QUERY_FN", "match_documents")

# Enhanced Smart Responses with Regex Patterns and Semantic Variations
SMART_RESPONSES: Dict[Tuple[str, ...], Callable[[str], str]] = {
    # Greetings - Enhanced with variations
    ("ุงููุง", "ุฃููุง", "ูุฑุญุจุง", "ุงูุณูุงู ุนูููู", "hello", "hi", "ูุฑุญุจุชูู", "ููุง", "ุฃูููู", 
     "ุตุจุงุญ ุงูุฎูุฑ", "ูุณุงุก ุงูุฎูุฑ", "ุตุจุงุญ ุงูููุฑ", "ูุณุงุก ุงูููุฑ", "ุฃููุงู ูุณููุงู", "ุฃููุงู ูุณููุงู ุจู"): 
        lambda user: f"ุฃููุงู {user}!" if user else "ุฃููุงู ูุณููุงู! ููู ุญุงููุ ุฃูุง ุตุฏููุ ูุณุงุนุฏู ุงูุฐูู ูู ุฏูุงู ูุฌูุ ุณุนูุฏ ุจููุงุฆู.",
    
    # Farewells - Enhanced
    ("ูุน ุงูุณูุงูุฉ", "ุฅูู ุงูููุงุก", "goodbye", "bye", "ุณูุงู", "ุจุงู", "ูุฏุงุนุงู", "ุฅูู ุงูููุงุก", 
     "ุฃุฑุงู ูุงุญูุงู", "ุฃุฑุงู ูุฑูุจุงู", "ุฃุฑุงู ุบุฏุงู", "ุฃุฑุงู ุจุนุฏ ูููู"): 
        lambda _: "ูุฏุงุนุงู! ูุชููู ูู ูููุงู ุณุนูุฏุงู.",
    
    # How are you - Enhanced with variations
    ("ููู ุงูุญุงู", "ููู ุญุงูู", "how are you", "ุดุฎุจุงุฑู", "ุดูููู", "ูููู", "ููู ุงูุฃููุฑ", 
     "ููู ุงูุญูุงุฉ", "ููู ุงูุฃูุงู", "ููู ุงููุถุน", "ููู ุชุณูุฑ ุงูุฃููุฑ"): 
        lambda user: f"ุงูุญูุฏ ููู ุจุฎูุฑ {user or ''}. ููู ุฃูุฏุฑ ุฃุณุงุนุฏู ุงููููุ",
    
    # Thanks - Enhanced
    ("ุดูุฑุง", "ุดูุฑุงู", "thank you", "thanks", "ูุดููุฑ", "ุชุณูู", "ุชุณูู ุฅูุฏู", "ุงููู ูุณููู", 
     "ุฃุดูุฑู", "ุฃุดูุฑู ูุซูุฑุงู", "ุดูุฑุงู ุฌุฒููุงู", "ุดูุฑุงู ูู"): 
        lambda user: f"ุงูุนูู {user or ''}! ุณุนูุฏ ุจูุณุงุนุฏุชู.",
    
    # About the assistant - Enhanced
    ("ุงุณูู", "your name", "ูู ุงูุช", "ูู ุฃูุช", "ูุด ุงุณูู", "ูุง ุงุณูู", "ูุง ุงุณูู", "ููู ุฃุณูู", 
     "ูุง ุงุณูู ุงูุญูููู", "ูู ูู ุงุณู", "ูุง ุงุณูู ูุง ูุณุงุนุฏ"): 
        lambda _: "ุฃูุง ุตุฏููุ ูุณุงุนุฏู ุงูุฐูู ูู ุฏูุงู ูุฌู. ุฃุณุงุนุฏู ูู ุงูุชุณูู ูุงูุฅุฌุงุจุฉ ุนูู ุฃุณุฆูุชู.",
    
    # About the user - Enhanced
    ("ูุด ุงุณูู", "ูุง ุงุณูู", "ุงุณูู", "my name", "who am i", "ูู ุฃูุง", "ูู ุชุนุฑู ุงุณูู", 
     "ูุง ุงุณูู ุนูุฏู", "ูู ุชุฐูุฑ ุงุณูู", "ูุง ุงุณูู ูู ุฐุงูุฑุชู"): 
        lambda user: f"ุงุณูู {user} ๐" if user and user != "ูุณุชุฎุฏู" else "ุนุฐุฑุงูุ ูุง ุฃุนุฑู ุงุณูู. ูู ููููู ุฅุฎุจุงุฑู ุจุงุณููุ",
    
    # Capabilities - Enhanced
    ("ูุด ุชูุฏุฑ ุชุณูู", "what can you do", "ูุฏุฑุงุชู", "ูุด ุชุณูู", "ุฅูุด ุชูุฏุฑ", "ูุง ูู ูุฏุฑุงุชู", 
     "ูุงุฐุง ุชุณุชุทูุน ุฃู ุชูุนู", "ูุง ูู ุฅููุงููุงุชู", "ูุง ุงูุฐู ููููู ูุนูู", "ููู ููููู ูุณุงุนุฏุชู"): 
        lambda _: "ุฃุณุงุนุฏู ูู: ุงูุจุญุซ ุนู ุงูููุชุฌุงุชุ ูุนุฑูุฉ ุงููุฑูุนุ ุทุฑู ุงูุฏูุนุ ุงูููุงุชูุฑุ ุฅูุฎ.",
    
    # About the company - Enhanced
    ("ุฏูุงู ูุฌู", "ุงูุดุฑูุฉ", "company", "ุงููุชุฌุฑ", "ุงูููุตุฉ", "ูุง ูู ุฏูุงู ูุฌู", "ุชุนุฑูู ุฏูุงู ูุฌู", 
     "ูุง ูู ุดุฑูุชูู", "ูุง ูู ููุตุชูู", "ูุง ูู ุฏูุงู ูุฌู", "ูุง ูู ุงูุฎุฏูุฉ ุงูุชู ุชูุฏููููุง"): 
        lambda user: f"ุฏูุงู ูุฌู ููุตุฉ ุณุนูุฏูุฉ ูุจุชูุฑุฉ ุชูุฏู ุชุฌุฑุจุฉ ุชุณูู ุฐููุฉุ ุชุฏุฎูุ ุชุฎุชุงุฑ ููุชุฌุงุชูุ ูุชุฎุฑุฌ ุจุฏูู ุงูุญุงุฌุฉ ูููููู ุนูุฏ ุงููุงุดูุฑ.",
    
    # QR codes - Enhanced
    ("qr", "ููู ุขุฑ", "ุจุงุฑููุฏ", "ููุฏ", "ููุฏ qr", "ููุฏ ููู ุขุฑ", "ููู ุฃุณุชุฎุฏู qr", 
     "ููู ุฃูุณุญ ุงูููุฏ", "ููู ุฃุจุฏุฃ ุงูุชุณูู", "ููู ุฃุฏุฎู ุงููุชุฌุฑ", "ุทุฑููุฉ ุงูุฏุฎูู"): 
        lambda _: "ูู ุฏูุงู ูุฌู ุชุจุฏุฃ ุฑุญูุชู ุจูุณุญ ููุฏ QRุ ููู ุซู ููููู ุงูุชุณูู ุจุญุฑูุฉ ูุงูุฏูุน ูุชู ุจุดูู ุชููุงุฆู ูุณูุณ ุนูุฏ ุงููุบุงุฏุฑุฉ.",
    
    # AI - Enhanced
    ("ุฐูุงุก ุงุตุทูุงุนู", "ai", "artificial intelligence", "ุงูุฐูุงุก", "ูู ุฃูุช ุฐูู", "ููู ุชุนูู", 
     "ูุง ูู ุชูููุงุชูู", "ูู ุชุณุชุฎุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู", "ููู ุชููู ุงูุฃุณุฆูุฉ"): 
        lambda _: "ูุณุชุฎุฏู ุชูููุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุชุชุจุน ุงููุดุชุฑูุงุชุ ุชุฎุตูุต ุงูุนุฑูุถุ ูุถูุงู ุชุฌุฑุจุฉ ุณูุณุฉ ุจุฏูู ุชุฏุฎู ูุฏูู.",
    
    # Vending machines - Enhanced
    ("ุขูุฉ ุจูุน", "ูุงูููุฉ", "vending machine", "ูุงูููุงุช", "ูุง ูู ุงูุขูุงุช", "ููู ุชุนูู ุงูุขูุงุช", 
     "ูุง ูู ุงููุงูููุงุช", "ูู ูู ูุงูููุงุช ุจูุน ุนุงุฏูุฉ", "ูุง ุงููุฑู ุจูููู ูุจูู ุงููุงูููุงุช ุงูุนุงุฏูุฉ"): 
        lambda _: "ุขูุงุชูุง ููุณุช ูุฌุฑุฏ ูุงูููุงุช ุจูุน ุชูููุฏูุฉุ ุจู ูู ููุตุงุช ุฐููุฉ ุชุชูุญ ูู ุงูุฏุฎููุ ุงุฎุชูุงุฑ ุงูููุชุฌุงุชุ ูุงูุฎุฑูุฌ ูุงูุฏูุน ูุจุงุดุฑุฉ ุจุฏูู ุงูุชุธุงุฑ.",
    
    # How to buy - Enhanced
    ("ููู ุฃุดุชุฑู", "ุทุฑููุฉ ุงูุฏูุน", "ููู ุฃุณุชุฎุฏู", "ุทุฑููุฉ ุงูุดุฑุงุก", "ูุด ุชูุฏู ุงูููุตุฉ", "ุงูุฎุฏูุงุช", 
     "ููู ุฃุชุณูู", "ุทุฑููุฉ ุงูุชุณูู", "ููู ุฃุณุชุฎุฏู ุงูุฎุฏูุฉ", "ูุง ูู ุงูุฎุฏูุงุช ุงููุชููุฑุฉ", 
     "ููู ูููููู ุงูุดุฑุงุก", "ุทุฑููุฉ ุงูุงุณุชุฎุฏุงู"): 
        lambda user: f"ุฏูุงู ูุฌู ููุฏู: 1) ุชุณูู ุณุฑูุน ุนุจุฑ QRุ 2) ููุชุฌุงุช ูุชููุนุฉ (ูุดุฑูุจุงุชุ ูุฌุจุงุช ุฎูููุฉ)ุ 3) ุฏูุน ุฅููุชุฑููู ุขููุ 4) ูุฑูุน 24/7ุ 5) ุชุฌุฑุจุฉ ุฐููุฉ ูุฎุตุตุฉ.",
    
    # Payment methods - Enhanced
    ("ููู ุงุฏูุน", "ุทุฑู ุงูุฏูุน", "payment", "ุฏูุน", "ูุง ูู ุทุฑู ุงูุฏูุน", "ููู ูููููู ุงูุฏูุน", 
     "ูู ุชูุจููู ุงูุจุทุงูุงุช", "ูู ุชูุจููู ุงูููุฏ", "ูุง ูู ูุณุงุฆู ุงูุฏูุน ุงููุชููุฑุฉ", 
     "ูู ุชูุจููู apple pay", "ูู ุชูุจููู google pay"): 
        lambda _: "ูุฏุนู ูู ุฏูุงู ูุฌู: ูุฏู/ุจุทุงูุงุชุ Apple Pay/Google Payุ ููุฏุงูุ ูSTC Pay.",
    
    # Branches - Enhanced (REMOVED - now handled by database queries)
    # ("ุฃูู ุงููุฑูุน", "ููู ูููุนูู", "ูุฑูุน", "branches", "locations", "ุฃูู ุชูุฌุฏ ูุฑูุนูู", 
    #  "ูุง ูู ููุงูุน ุงููุฑูุน", "ูู ูุฏููู ูุฑูุน ูู ุงูุฑูุงุถ", "ูู ูุฏููู ูุฑูุน ูู ุฌุฏุฉ", 
    #  "ุฃูู ูููููู ุงูุนุซูุฑ ุนูููู", "ูุง ูู ุงููุฏู ุงูุชู ูุฏููู ูููุง ูุฑูุน"): 
    #     lambda user: f"ูุฏููุง ูุฑูุน ุฏูุงู ูุฌู ูู ุงูุฑูุงุถ ูุฌุฏุฉ ูุงูุฏูุงู ูุงูุฎุจุฑ ูุงููุฏููุฉ.",
    
    # Working hours - Enhanced
    ("ูุชู ุชูุชุญูู", "ุณุงุนุงุช ุงูุนูู", "open", "ูุชู ุชุบูููู", "ูู ุชุนูููู 24 ุณุงุนุฉ", 
     "ูุง ูู ุณุงุนุงุช ุงูุนูู", "ูู ุชุนูููู ูู ุงูููู", "ูู ุชุนูููู ูู ุงูุนุทู", 
     "ูุชู ูููููู ุฒูุงุฑุชูู", "ูุง ูู ุฃููุงุช ุงูุนูู"): 
        lambda _: "ูุฑูุน ุฏูุงู ูุฌู ุชุนูู 24/7 ูุชูููุฑ ุงูุฎุฏูุฉ ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ.",
    
    # Prices - Enhanced (General price info only, not specific product queries)
    ("ูู ุงูุฃุณุนุงุฑ", "ูุง ูู ุงูุฃุณุนุงุฑ", "ูู ุงูุฃุณุนุงุฑ ูุนูููุฉ", 
     "ูุง ูู ูุทุงู ุงูุฃุณุนุงุฑ", "ูู ุงูุฃุณุนุงุฑ ููุงูุณุฉ", "ูุง ูู ุชูููุฉ ุงูููุชุฌุงุช", 
     "ูู ุงูุฃุณุนุงุฑ ูุฑุชูุนุฉ", "ูุง ูู ูุชูุณุท ุงูุณุนุฑ"): 
        lambda user: f"ุฃุณุนุงุฑ ุฏูุงู ูุฌู ุชุชุฑุงูุญ ูู 2.50 ุฑ.ุณ ุฅูู 8.00 ุฑ.ุณ ุญุณุจ ุงูููุชุฌ.",
    
    # Weather - Enhanced
    ("ุงูุทูุณ", "weather", "ููู ุงูุทูุณ", "ูุง ูู ุงูุทูุณ", "ูู ุงูุทูุณ ุญุงุฑ", "ูู ุงูุทูุณ ุจุงุฑุฏ"): 
        lambda _: "ูุง ุฃูุฏุฑ ุฃุฌูุจ ุงูุทูุณ ุงูุขูุ ููู ุฃูุฏุฑ ุฃุณุงุนุฏู ูู ุงูุชุณูู ูู ุฏูุงู ูุฌู.",
    
    # Date - Enhanced
    ("ุงูุชุงุฑูุฎ", "date", "ุงูููู", "ูุง ูู ุงูุชุงุฑูุฎ", "ูุง ูู ุงูููู", "ูู ุฃู ููู ูุญู"): 
        lambda _: f"ุงูุชุงุฑูุฎ: {__import__('datetime').datetime.now().strftime('%Y/%m/%d')}",
    
    # Knowledge scope - Enhanced
    ("ูุทุงู ูุนุฑูุชู", "ูุทุงู ุงููุนุฑูุฉ", "ูุฏุฑุงุชู", "ูุด ุชูุฏุฑ", "ุฅูุด ุชูุฏุฑ", "ูุง ูู ุญุฏูุฏ ูุนุฑูุชู", 
     "ูุง ุงูุฐู ุชุนุฑูู", "ูุง ุงูุฐู ูุง ุชุนุฑูู", "ูู ุชุนุฑู ูู ุดูุก", "ูุง ูู ูุฌุงูุงุช ุฎุจุฑุชู"): 
        lambda user: f"ูุทุงู ูุนุฑูุชู ูุชุฑูุฒ ุนูู ุฏูุงู ูุฌู: ุงูููุชุฌุงุชุ ุงููุฑูุนุ ุงูููุงุชูุฑุ ุทุฑู ุงูุฏูุนุ ุงูุฎุฏูุงุชุ ูุงูุชุณูู ุงูุฐูู. ูููููู ูุณุงุนุฏุชู ูู ุฃู ุงุณุชูุณุงุฑ ุญูู ุฎุฏูุงุชูุง.",
    
    # Platform context - Enhanced
    ("ุงูููุตุฉ", "platform", "ุงูุณูุงู", "context", "ูุง ูู ุงูููุตุฉ", "ูุง ูู ุงูุณูุงู", 
     "ูุง ูู ุงูุฎุฏูุฉ", "ูุง ูู ุงููุดุฑูุน", "ูุง ูู ุงูุดุฑูุฉ", "ูุง ูู ุฏูุงู ูุฌู"): 
        lambda user: f"ุงูููุตุฉ ุงูุชู ุฃุชุญุฏุซ ุนููุง ูู ุฏูุงู ูุฌู - ููุตุฉ ุงูุชุณูู ุงูุฐูู ุงูุณุนูุฏูุฉ. ูุญู ููุฏู ุฎุฏูุงุช ุงูุจูุน ุงูุขูู ุงูุฐูู ูุน ุชุฌุฑุจุฉ ุฏูุน ุณุฑูุนุฉ ูุขููุฉ.",
}

# Enhanced Smart Product Queries with Semantic Variations
SMART_PRODUCT_QUERIES: Dict[Tuple[str, ...], str] = {
    # Price queries - Enhanced with variations
    ("ุงุนูู ุณุนุฑ", "ุฃุนูู ุณุนุฑ", "ุงุบูู", "ุฃุบูู", "ุฃุนูู ุชูููุฉ", "ุงุนูู ุชูููุฉ", "highest price", "most expensive",
     "ูุง ูู ุฃุบูู ููุชุฌ", "ูุง ูู ุงูุฃุนูู ุณุนุฑุงู", "ูุง ูู ุงูุฃุบูู", "ูุง ูู ุงูุฃุนูู ุชูููุฉ", 
     "ุฃู ููุชุฌ ุฃุบูู", "ุฃู ููุชุฌ ุฃุนูู ุณุนุฑุงู", "ูุง ูู ุงูููุชุฌ ุงูุฃุบูู", "ูุง ูู ุงูููุชุฌ ุงูุฃุนูู ุณุนุฑุงู"): "highest_price",
    
    ("ุงูู ุณุนุฑ", "ุฃูู ุณุนุฑ", "ุงุฑุฎุต", "ุฃุฑุฎุต", "ุฃูู ุชูููุฉ", "ุงูู ุชูููุฉ", "lowest price", "cheapest",
     "ูุง ูู ุฃุฑุฎุต ููุชุฌ", "ูุง ูู ุงูุฃูู ุณุนุฑุงู", "ูุง ูู ุงูุฃุฑุฎุต", "ูุง ูู ุงูุฃูู ุชูููุฉ",
     "ุฃู ููุชุฌ ุฃุฑุฎุต", "ุฃู ููุชุฌ ุฃูู ุณุนุฑุงู", "ูุง ูู ุงูููุชุฌ ุงูุฃุฑุฎุต", "ูุง ูู ุงูููุชุฌ ุงูุฃูู ุณุนุฑุงู"): "lowest_price",
    
         ("ุงุนูู ูุงููุฑู", "ุฃุนูู ูุงููุฑู", "ุฃุนูู ุณุนุฑุงุช", "ุงุนูู ุณุนุฑุงุช", "highest calories", "most calories",
      "ูุง ูู ุฃุนูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ูุง ูู ุงูุฃูุซุฑ ุณุนุฑุงุช", "ุฃู ููุชุฌ ุฃุนูู ุณุนุฑุงุช", 
      "ูุง ูู ุงูููุชุฌ ุงูุฃุนูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ุงูุซุฑ ููุชุฌ ูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ุฃูุซุฑ ููุชุฌ ูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ",
      "ูุด ุงูุซุฑ ููุชุฌ ูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ูุด ุฃูุซุฑ ููุชุฌ ูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ุงูุซุฑ ููุชุฌ ุณุนุฑุงุช", "ุฃูุซุฑ ููุชุฌ ุณุนุฑุงุช",
      "ูุด ุงูุซุฑ ููุชุฌ ููู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ูุด ุฃูุซุฑ ููุชุฌ ููู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ุงูุซุฑ ููุชุฌ ููู ุณุนุฑุงุช", "ุฃูุซุฑ ููุชุฌ ููู ุณุนุฑุงุช"): "highest_calories",
     
     ("ุงูู ูุงููุฑู", "ุฃูู ูุงููุฑู", "ุงูู ุณุนุฑุงุช", "ุฃูู ุณุนุฑุงุช", "lowest calories", "least calories",
      "ูุง ูู ุฃูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ูุง ูู ุงูุฃูู ุณุนุฑุงุช", "ุฃู ููุชุฌ ุฃูู ุณุนุฑุงุช", 
      "ูุง ูู ุงูููุชุฌ ุงูุฃูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ุงุฑุฎุต ููุชุฌ ูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ุฃุฑุฎุต ููุชุฌ ูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ",
      "ูุด ุงุฑุฎุต ููุชุฌ ูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ูุด ุฃุฑุฎุต ููุชุฌ ูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ุงุฑุฎุต ููุชุฌ ุณุนุฑุงุช", "ุฃุฑุฎุต ููุชุฌ ุณุนุฑุงุช",
      "ูุด ุงุฑุฎุต ููุชุฌ ููู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ูุด ุฃุฑุฎุต ููุชุฌ ููู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ุงุฑุฎุต ููุชุฌ ููู ุณุนุฑุงุช", "ุฃุฑุฎุต ููุชุฌ ููู ุณุนุฑุงุช"): "lowest_calories",
    
    # Calories queries - Enhanced
    ("ูู ููู ุณุนุฑุฉ", "ูู ุณุนุฑุฉ", "ูู ุณุนุฑุงุช", "ูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "calories", "ุณุนุฑุงุช ุญุฑุงุฑูุฉ", "ุณุนุฑุฉ ุญุฑุงุฑูุฉ",
     "ูุง ูู ุงูุณุนุฑุงุช ุงูุญุฑุงุฑูุฉ", "ูู ุงูุณุนุฑุงุช", "ูุง ูู ุงูุณุนุฑุงุช", "ูู ุงูููุชุฌุงุช ุนุงููุฉ ุงูุณุนุฑุงุช",
     "ูุง ูู ุงูุณุนุฑุงุช ุงูุญุฑุงุฑูุฉ ููููุชุฌุงุช", "ูู ุณุนุฑุงุช ุญุฑุงุฑูุฉ ูู ุงูููุชุฌุงุช"): "all_calories",
    
    # Specific product categories - Enhanced with semantic variations
    ("ูู ุณุนุฑ ุงูุนุตูุฑ", "ุณุนุฑ ุงูุนุตูุฑ", "ุชูููุฉ ุงูุนุตูุฑ", "price of juice", "ูุง ูู ุณุนุฑ ุงูุนุตูุฑ",
     "ูู ุชูููุฉ ุงูุนุตูุฑ", "ูุง ูู ุฃุณุนุงุฑ ุงูุนุตุงุฆุฑ", "ูู ุณุนุฑ ุงููุดุฑูุจุงุช", "ูุง ูู ุณุนุฑ ุงููุดุฑูุจ",
     "ูู ุชูููุฉ ุงููุดุฑูุจุงุช", "ูุง ูู ุฃุณุนุงุฑ ุงููุดุฑูุจุงุช", "ูู ุณุนุฑ ุงูุนุตุงุฆุฑ", "ูุง ูู ุณุนุฑ ุงูุนุตุงุฆุฑ"): "juice_prices",
    
    ("ูู ุณุนุฑ ุงูุญููุจ", "ุณุนุฑ ุงูุญููุจ", "ุชูููุฉ ุงูุญููุจ", "price of milk", "ูุง ูู ุณุนุฑ ุงูุญููุจ",
     "ูู ุชูููุฉ ุงูุญููุจ", "ูุง ูู ุฃุณุนุงุฑ ุงูุญููุจ", "ูู ุณุนุฑ ุงูุฃูุจุงู", "ูุง ูู ุณุนุฑ ุงููุจู",
     "ูู ุชูููุฉ ุงูุฃูุจุงู", "ูุง ูู ุฃุณุนุงุฑ ุงูุฃูุจุงู"): "milk_prices",
    
    ("ูู ุณุนุฑ ุงูุดููููุงุชุฉ", "ุณุนุฑ ุงูุดููููุงุชุฉ", "ุชูููุฉ ุงูุดููููุงุชุฉ", "price of chocolate", "ูุง ูู ุณุนุฑ ุงูุดููููุงุชุฉ",
     "ูู ุชูููุฉ ุงูุดููููุงุชุฉ", "ูุง ูู ุฃุณุนุงุฑ ุงูุดููููุงุชุฉ", "ูู ุณุนุฑ ุงูุดููููุงุชู", "ูุง ูู ุณุนุฑ ุงูุดููููุงุชู",
     "ูู ุชูููุฉ ุงูุดููููุงุชู", "ูุง ูู ุฃุณุนุงุฑ ุงูุดููููุงุชู", "ูู ุณุนุฑ ุงูุญูููุงุช", "ูุง ูู ุณุนุฑ ุงูุญูููุงุช"): "chocolate_prices",
    
    ("ูู ุณุนุฑ ุงูุดูุจุณ", "ุณุนุฑ ุงูุดูุจุณ", "ุชูููุฉ ุงูุดูุจุณ", "price of chips", "ูู ุณุนุฑ ุงูููุฑูุดุงุช", "ุณุนุฑ ุงูููุฑูุดุงุช",
     "ูุง ูู ุณุนุฑ ุงูุดูุจุณ", "ูู ุชูููุฉ ุงูุดูุจุณ", "ูุง ูู ุฃุณุนุงุฑ ุงูุดูุจุณ", "ูู ุณุนุฑ ุงูููุฑูุดุงุช",
     "ูุง ูู ุณุนุฑ ุงูููุฑูุดุงุช", "ูู ุชูููุฉ ุงูููุฑูุดุงุช", "ูุง ูู ุฃุณุนุงุฑ ุงูููุฑูุดุงุช", "ูู ุณุนุฑ ุงููุฌุจุงุช ุงูุฎูููุฉ",
     "ูุง ูู ุณุนุฑ ุงููุฌุจุงุช ุงูุฎูููุฉ", "ูู ุชูููุฉ ุงููุฌุจุงุช ุงูุฎูููุฉ", "ูุง ูู ุฃุณุนุงุฑ ุงููุฌุจุงุช ุงูุฎูููุฉ"): "chips_prices",
    
    # Comparison - Enhanced
    ("ูุงุฑู", "ููุงุฑูุฉ", "ููุงุฑูู", "compare", "competition", "ููุงูุณุฉ", "ููุงูุณูู", "ุงูุงุณูุงู", "ูุชุฌุฑ ุงุฎุฑ", "ูุชุฌุฑ ุขุฎุฑ",
     "ูุง ูู ุงูููุงุฑูุฉ", "ููู ุชูุงุฑููู", "ูุง ูู ุงูููุงูุณุฉ", "ูู ุฃุณุนุงุฑูู ููุงูุณุฉ", "ูุง ูู ุฃุณุนุงุฑ ุงูููุงูุณูู",
     "ูู ุฃุณุนุงุฑูู ุฃูุถู", "ูู ุฃุณุนุงุฑูู ุฃุนูู", "ูู ุฃุณุนุงุฑูู ุฃูู", "ูุง ูู ูุฒุงูุงูู", "ูุง ูู ุนููุจูู"): "price_comparison",
}

# Enhanced Product Keywords with variations
PRODUCT_KEYWORDS: List[str] = [
    # Original keywords
    "ุนุตูุฑ ุงููุฑุงุนู", "ุนุตูุฑ ุงูุฑุจูุน", "ุจุงุฑูู", "ุจุณูุฑูู", "ุฌุงููุณู", 
    "ุณููุชูุฒ", "ููุช ูุงุช", "ููููุฑ", "ุญููุจ ูุงุฏู", "ุฃูุฑูู", 
    "ุจุฑูุชูู ุจุงุฑ", "ุตู ุชูุจ", "ุดูุจุณ ููุฒ", "ุจุฑููุฌูุฒ ุจุงุฑุจููู",
    
    # Variations and synonyms
    "ุนุตูุฑ", "ูุดุฑูุจ", "ุนุตุงุฆุฑ", "ูุดุฑูุจุงุช", "ุงููุฑุงุนู", "ุงูุฑุจูุน", "ูุงุฏู",
    "ุดููููุงุชุฉ", "ุดููููุงุชู", "ุญูููุงุช", "ุญูููุงุช", "ุจุงุฑูู", "ุฌุงููุณู",
    "ููุช ูุงุช", "ููุชูุงุช", "ุฃูุฑูู", "ุงูุฑูู", "ุดูุจุณ", "ููุฑูุดุงุช", "ุจุฑููุฌูุฒ",
    "ุจุฑูุชูู", "ุตู ุชูุจ", "ุตู ุชูุจ", "ุจุณูุฑูู", "ุจุณูุฑูู", "ููููุฑ", "ุณููุชูุฒ"
]

# Enhanced Database Queries with semantic variations
DATABASE_QUERIES: Dict[Tuple[str, ...], str] = {
    # Products - Enhanced
    ("ุงูููุชุฌุงุช", "products", "product", "ูุด ุงูููุชุฌุงุช", "ูุง ูู ุงูููุชุฌุงุช", "ุนุฑุถ ุงูููุชุฌุงุช",
     "ูุง ุงูููุชุฌุงุช ุงููุชููุฑุฉ", "ูุง ูู ุงูุจุถุงุฆุน", "ูุง ูู ุงูุณูุน", "ูุง ูู ุงูุฃุตูุงู",
     "ูุง ุงูููุชุฌุงุช ุงูููุฌูุฏุฉ", "ูุง ูู ุงูููุชุฌุงุช ุงููุชุงุญุฉ", "ูุง ูู ุงูููุชุฌุงุช ุงููุทุฑูุญุฉ"): "products",
    
    # Prices - Enhanced
    ("ุงูุงุณุนุงุฑ", "prices", "price", "ูู ุงูุณุนุฑ", "ูู ุงูุงุณุนุงุฑ", "ุงูุชูููุฉ", "cost",
     "ูุง ูู ุงูุฃุณุนุงุฑ", "ูุง ูู ุงูุชูููุฉ", "ูุง ูู ุงูุฃุณุนุงุฑ", "ูุง ูู ุงูุชูุงููู",
     "ูุง ูู ุฃุณุนุงุฑ ุงูููุชุฌุงุช", "ูุง ูู ุชูููุฉ ุงูููุชุฌุงุช", "ูุง ูู ุฃุณุนุงุฑ ุงูุจุถุงุฆุน"): "prices",
    
    # Branches - Enhanced
    ("ุงููุฑูุน", "branches", "branch", "ููู ุงููุฑูุน", "ุฃูู ุงููุฑูุน", "ููุงูุน ุงููุฑูุน", "ูุฑูุนูู",
     "ูุง ูู ุงููุฑูุน", "ูุง ูู ุงูููุงูุน", "ูุง ูู ุงูุฃูุงูู", "ูุง ูู ุงูููุงุทู",
     "ูุง ูู ุงููุฏู", "ูุง ูู ุงูููุงูุน ุงููุชููุฑุฉ", "ูุง ูู ุงููุฑูุน ุงููุชุงุญุฉ",
     "ูู ูุฑุน ููุฌูุฏ", "ุนุฏุฏ ุงููุฑูุน", "ูู ุนุฏุฏ ุงููุฑูุน", "ูู ูุฑุน", "ุนุฏุฏ ูุฑูุนูู",
     "ูู ูุฑุน ูุฏููู", "ูู ูุฑุน ููุฌูุฏ", "ูู ูุฑุน ุนูุฏูู", "ูู ูุฑุน ูู ุงูุฑูุงุถ",
     "ูู ูุฑุน ูู ุฌุฏุฉ", "ูู ูุฑุน ูู ุงูุฏูุงู", "ูู ูุฑุน ูู ุงูุฎุจุฑ", "ูู ูุฑุน ูู ุงููุฏููุฉ"): "branches",
    
    # Invoices (user-specific) - Enhanced
    ("ููุงุชูุฑู", "ููุงุชูุฑู", "invoices", "invoice", "ูู ุนุฏุฏ ููุงุชูุฑู", "ุนุฑุถ ููุงุชูุฑู", "ููุงุชูุฑู",
     "ูุง ูู ููุงุชูุฑู", "ูุง ูู ูุดุชุฑูุงุชู", "ูุง ูู ุทูุจุงุชู", "ูุง ูู ุฃูุงูุฑู",
     "ูุง ูู ููุงุชูุฑู ุงูุณุงุจูุฉ", "ูุง ูู ูุดุชุฑูุงุชู ุงูุณุงุจูุฉ", "ูุง ูู ุทูุจุงุชู ุงูุณุงุจูุฉ"): "user_invoices",
    
    # General invoices - Enhanced
    ("ุงูููุงุชูุฑ", "invoices", "invoice", "ูุง ูู ุงูููุงุชูุฑ", "ูุง ูู ุงููุดุชุฑูุงุช", "ูุง ูู ุงูุทูุจุงุช",
     "ูุง ูู ุงูุฃูุงูุฑ", "ูุง ูู ุงูููุงุชูุฑ ุงููุชููุฑุฉ", "ูุง ูู ุงููุดุชุฑูุงุช ุงููุชููุฑุฉ"): "general_invoices",
}

# Enhanced Product Translations with variations
PRODUCT_TRANSLATIONS: Dict[str, str] = {
    'Almarai_juice': 'ุนุตูุฑ ุงููุฑุงุนู',
    'alrabie_juice': 'ุนุตูุฑ ุงูุฑุจูุน',
    'Nadec_Mlik': 'ุญููุจ ูุงุฏู',
    'Sun_top': 'ุตู ุชูุจ',
    'barni': 'ุจุงุฑูู',
    'biskrem': 'ุจุณูุฑูู',
    'loacker': 'ููููุฑ',
    'oreos': 'ุฃูุฑูู',
    'galaxy': 'ุฌุงููุณู',
    'green_skittles': 'ุณููุชูุฒ ุฃุฎุถุฑ',
    'kit_kat': 'ููุช ูุงุช',
    'pink_skittles': 'ุณููุชูุฒ ูุฑุฏู',
    'protein_bar': 'ุจุฑูุชูู ุจุงุฑ',
    'Lays_chips': 'ุดูุจุณ ููุฒ',
    'pringles_barbeque': 'ุจุฑููุฌูุฒ ุจุงุฑุจููู'
}

# Regex patterns for flexible matching
REGEX_PATTERNS: Dict[str, str] = {
    # Price patterns (general price info only, not specific product queries)
    "price_query": r"(ูู|ูุง|ููู|ุฃู|ูู).*(ุฃุณุนุงุฑ|ุชูููุฉ|ุซูู|ูููุฉ).*(ุนุงูุฉ|ูุชูุณุท|ูุทุงู|ููุงูุณุฉ)",
    
    # Location patterns
    "location_query": r"(ุฃูู|ููู|ูู ุฃู|ูุง ูู|ูู).*(ูุฑุน|ูููุน|ููุงู|ููุงู|ูุฏููุฉ|ููุทูุฉ)",
    
    # Product info patterns
    "product_info": r"(ูุนูููุงุช|ุชูุงุตูู|ูุตู|ูุง ูู|ููู).*(ุนุตูุฑ|ุญููุจ|ุดููููุงุชุฉ|ุดูุจุณ|ููุฑูุดุงุช|ุจุงุฑูู|ุฌุงููุณู|ููุช ูุงุช|ุฃูุฑูู)",
    
    # Working hours patterns
    "hours_query": r"(ูุชู|ูู ุฃู|ูุง ูู|ูู).*(ููุชุญ|ูุบูู|ูุนูู|ุณุงุนุงุช|ุฃููุงุช|ููุช)",
    
    # Payment patterns
    "payment_query": r"(ููู|ูุง ูู|ูู|ุฃู).*(ูุฏูุน|ุฏูุน|ุจุทุงูุฉ|ููุฏ|apple pay|google pay|ูุฏู)",
}
